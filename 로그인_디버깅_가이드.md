# 카카오 로그인 디버깅 가이드

"로그인 정보를 보내는데 로그인 성공이 안된다"는 문제를 해결하기 위한 가이드입니다.

---

## 단계별 확인 방법

브라우저 콘솔(F12)에서 다음 로그를 확인하세요:

### 1단계: 카카오 로그인 팝업
- `[카카오 로그인] 1단계: 카카오 로그인 시작` ✅
- `[카카오 로그인] Auth.login() 호출 완료` ✅
- `[카카오 로그인] 1단계 완료: 카카오 로그인 성공` ← 여기서 멈추면?

### 2단계: 서버로 토큰 전송
- `[카카오 로그인] 2단계: 서버로 토큰 전송 시작` ✅
- `[카카오 로그인] 2단계: 서버 응답 받음` ← 여기서 멈추면?
- `[카카오 로그인] 2단계 완료: Custom Token 수신` ← 여기서 멈추면?

### 3단계: Firebase 로그인
- `[카카오 로그인] 3단계: Firebase 로그인 시작` ✅
- `[카카오 로그인] 3단계 완료: Firebase 로그인 성공` ← 여기서 멈추면?

### 4단계: 프로필 확인/생성
- `[카카오 로그인] 4단계: 사용자 프로필 확인/생성` ✅
- `[카카오 로그인] 4단계 완료` ✅
- `[카카오 로그인] 전체 프로세스 완료!` ✅

---

## 각 단계별 문제 해결

### 1단계에서 멈춤: 카카오 팝업 문제

**증상**: `Auth.login() 호출 완료` 후 `1단계 완료`가 안 나옴

**원인**:
- 팝업이 차단됨
- Redirect URI 설정 문제

**해결**:
1. 브라우저 주소창 오른쪽의 팝업 차단 아이콘 확인
2. 카카오 개발자 콘솔에서 Redirect URI 설정 확인 (`http://localhost:3000/login`)

---

### 2단계에서 멈춤: 서버 API 문제

**증상**: `서버로 토큰 전송 시작` 후 응답이 없음

**원인**:
- 서버 API 에러
- Firebase Admin 설정 문제
- 카카오 API 호출 실패

**해결**:
1. **서버 터미널 확인** - 에러 메시지 확인
2. `.env.local`의 Firebase Admin 설정 확인:
   - `FIREBASE_PROJECT_ID`
   - `FIREBASE_CLIENT_EMAIL`
   - `FIREBASE_PRIVATE_KEY`
3. 서버 로그에서 `[카카오 API]` 로그 확인

**서버 에러 확인**:
- `Firebase Admin 초기화 실패` → 환경 변수 확인
- `카카오 API 오류` → 카카오 액세스 토큰 문제
- `Firebase 사용자 처리 오류` → Firebase Admin 설정 문제

---

### 3단계에서 멈춤: Firebase 로그인 문제

**증상**: `Firebase 로그인 시작` 후 실패

**원인**:
- Custom Token이 잘못됨
- Firebase 클라이언트 설정 문제

**해결**:
1. `.env.local`의 Firebase 클라이언트 설정 확인:
   - `NEXT_PUBLIC_FIREBASE_API_KEY`
   - `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`
   - `NEXT_PUBLIC_FIREBASE_PROJECT_ID`
   - 등등...
2. 브라우저 콘솔에서 Firebase 에러 확인
3. 서버 로그에서 Custom Token 생성 성공 여부 확인

---

### 4단계에서 멈춤: Firestore 문제

**증상**: `프로필 확인/생성` 후 실패

**원인**:
- Firestore 권한 문제
- 네트워크 문제

**해결**:
1. Firebase Console → Firestore → 규칙 확인
2. 브라우저 콘솔에서 Firestore 에러 확인
3. 네트워크 탭에서 Firestore 요청 확인

---

## 빠른 체크리스트

- [ ] 브라우저 콘솔(F12)에서 어느 단계에서 멈추는지 확인
- [ ] 서버 터미널에서 에러 메시지 확인
- [ ] `.env.local`의 모든 Firebase 설정 확인
- [ ] `.env.local`의 `NEXT_PUBLIC_KAKAO_JS_KEY` 확인
- [ ] 카카오 개발자 콘솔에서 Redirect URI 설정 확인
- [ ] 서버 재시작 (`npm run dev` 중지 후 다시 시작)
- [ ] 브라우저 새로고침 (Ctrl + F5)

---

## 에러 메시지별 해결

### "서버 응답이 지연되고 있습니다"
→ 서버 API가 느리거나 실패함. 서버 터미널 확인.

### "Firebase 로그인 실패"
→ Firebase 클라이언트 설정 또는 Custom Token 문제. `.env.local` 확인.

### "프로필 조회 실패" / "프로필 생성 실패"
→ Firestore 권한 또는 네트워크 문제. Firebase Console 확인.

---

## 여전히 안 되면

1. **브라우저 콘솔(F12)**의 **전체 로그** 복사
2. **서버 터미널**의 **에러 메시지** 확인
3. **어느 단계에서 멈추는지** 명확히 알려주시면 더 정확히 도와드릴 수 있습니다.
